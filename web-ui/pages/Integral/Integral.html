<link rel="stylesheet" href="/assets/Console/lookingFor/css/lookingFor.css" />
<link rel="stylesheet" href="/assets/Console/integral/css/integral.css" />
<script src="/assets/Console/integral/js/vue.js"></script>
<!-- 引入样式 -->
<link rel="stylesheet" href="/assets/Console/integral/css/index.css">
<!-- 引入组件库 -->
<script src="/assets/Console/integral/js/index.js"></script>
<div class="breadcrumb">
    <span class="layui-breadcrumb">
        <a href="/Home">首页</a>
        <a href="/lookingFor/lookingFor">寻找项目</a>
        <a><cite>项目报名</cite></a>
    </span>
</div>
<div class="content" id="content">
    <div class="container">
        <div class="looking-for-list">
            <div class="t">
                <div class="layui-card">
                    <div class="layui-card-header">个人信息</div>
                    <div class="layui-card-body">
                        <div class="l">
                            <a href="javascript:">
                                <p>
                                    <img src="/assets/console/public/images/top.png" alt="">
                                </p>
                            </a>
                        </div>
                        <div class="r">
                            <h2>早安，欢迎来到工作台，祝你开心每一天！</h2>
                            <div class="usermsg">
                                <div class="username">
                                    <h2>刘小姐</h2>
                                    <p><span>111</span></p>
                                </div>
                                <div class="grade">
                                    岗位等级
                                    <a href="javascript:">未认证</a>
                                </div>
                                <div class="grade">
                                    联系方式
                                    <a href="javascript:">15073231615</a>
                                </div>
                                <div class="grade">
                                    账号ID
                                    <a href="javascript:">15073231615</a>
                                </div>
                            </div>
                            <div class="btn">
                                <button type="button" class="layui-btn" id="sfrz">
                                    <a href="/identity/identityEntrance" class="white"><i
                                            class="layui-icon layui-icon-username"></i> 身份认证</a>
                                </button>
                                <button type="button" class="layui-btn">
                                    <i class="layui-icon layui-icon-list"></i> 完善资料
                                </button>
                            </div>
                        </div>
                        <div class="num">
                            <a href="javascript:">
                                <span>项目数</span>
                                <h2>15</h2>
                            </a>
                            <a href="javascript:">
                                <span>发布项目</span>
                                <h2>15</h2>
                            </a>
                            <a href="/Collect">
                                <span>收藏项目</span>
                                <h2>15</h2>
                            </a>
                            <a href="/FocusTalent">
                                <span>关注人才</span>
                                <h2>15</h2>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="b integral-main">
                <div class="layui-card">
                    <div class="layui-card-header">我的等级</div>
                    <div class="layui-card-body" style="height: 450px;">
                        <div class="dj-t">
                            <p><img src="/assets/Console/integral/images/zl-img.png" alt=""></p>
                            <p><img src="/assets/Console/integral/images/sjs-img.png" alt=""></p>
                            <p><img src="/assets/Console/integral/images/zyfzr-img.png" alt=""></p>
                            <h2>总积分：<span>25</span></h2>
                        </div>
                        <div class="dj-b">
                            <ul>
                                <li class="the the1">
                                    <div>
                                        <div></div>
                                        <div></div>
                                    </div>
                                    <p><img src="/assets/Console/integral/images/zl-icon.png" alt=""></p>
                                    <h2>设计师助理</h2>
                                    <span>所需积分：0</span>
                                </li>
                                <li class="line">
                                    <div>
                                        <span></span>
                                    </div>
                                </li>
                                <li class="the the2">
                                    <div>
                                        <div></div>
                                        <div></div>
                                    </div>
                                    <p><img src="/assets/Console/integral/images/sjs-icon.png" alt=""></p>
                                    <p style="display: none;"><img src="/assets/Console/integral/images/sjs-icon-on.png"
                                            alt=""></p>
                                    <h2>设计师</h2>
                                    <span>所需积分：50</span>
                                </li>
                                <li class="line">
                                    <div>
                                        <span></span>
                                    </div>
                                </li>
                                <li class="the the3">
                                    <div>
                                        <div></div>
                                        <div></div>
                                    </div>
                                    <p><img src="/assets/Console/integral/images/zyfzr-icon.png" alt=""></p>
                                    <p style="display: none;"><img
                                            src="/assets/Console/integral/images/zyfzr-icon-on.png" alt=""></p>
                                    <h2>专业负责人</h2>
                                    <span>所需积分：50</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="layui-card">
                    <div class="layui-card-header">我的积分</div>
                    <div class="layui-card-body" style="height: 450px;">
                        <div id="app">
                            <div class="jf-main">
                                <div class="jf-list jf1">
                                    <el-progress type="circle" :stroke-width="10" :percentage="75" color="#5B8FF9">
                                    </el-progress>
                                    <h2>基础底板施工图及计算书</h2>
                                </div>
                                <div class="jf-list jf2">
                                    <el-progress type="circle" :stroke-width="10" :percentage="60" color="#5AD8A6">
                                    </el-progress>
                                    <h2>地下室外墙及计算书</h2>
                                </div>
                                <div class="jf-list jf3">
                                    <el-progress type="circle" :stroke-width="10" :percentage="75" color="#E8684A">
                                    </el-progress>
                                    <h2>墙身大样配筋</h2>
                                </div>
                            </div>
                            <a href="/lookingFor/lookingForList" class="jf-btn">立即报名项目</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="b mx-main">
                <div class="layui-card">
                    <div class="layui-card-header">我的积分明细</div>
                    <div class="layui-card-body">
                        <div class="mx-down">
                            <p><i class="layui-icon layui-icon-down"></i></p>
                        </div>
                        <table id="table1" lay-filter="table1" style="display:none;"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    //我的积分
    new Vue({
        el: '#app',
        data: function () {
            return {
                visible: false,
            }
        },
        mounted: function () {
            $('.jf1 .el-progress__text').html('<span>6</span><em> / </em>8');
            $('.jf2 .el-progress__text').html('<span>15</span><em> / </em>20');
            $('.jf3 .el-progress__text').html('<span>6</span><em> / </em>8');
        }
    })

    function goTops(index) {
        if (index == 1) {
            //设计师
        } else if (index == 2) {
            //专业负责人
        }
    }
    let sfrzTips = null;
    $(function () {
        $('#sfrz').hover(function () {
            sfrzTips = layer.tips('恭喜您已经实名认证成功！ 现在您可以成为发包人、审核人、项目负责人了。', '#sfrz', {
                tips: 3,
                time: 0,
                skin: 'sf-tips',
                tipsMore: true
            });
            $('.sf-tips').css({
                'left': parseInt($('.sf-tips').css('left')) - 35
            })
        }, function () {
            layer.close(sfrzTips);
        })

        //默认高亮我的积分
        $('.layui-nav.layui-nav-tree .layui-nav-item').eq(3).addClass('layui-this');
        //我的积分明细展开/收缩
        $('.mx-down p').click(function () {
            if ($(this).hasClass('on')) {
                $(this).removeClass('on');
                $('div[lay-id="table1"]').remove();
            } else {
                $(this).addClass('on');
                $('#table1').show();
                table.render({
                    elem: '#table1',
                    height: 378,
                    url: '/Assets/console/lookingFor/js/test.json' //数据接口
                        ,
                    page: true //开启分页
                        ,
                    cols: [
                        [ //表头
                            {
                                field: 'id',
                                width: 80,
                                title: 'ID'
                            }, {
                                field: 'username',
                                width: 80,
                                title: '用户名'
                            }, {
                                field: 'sex',
                                width: 80,
                                title: '性别'
                            }, {
                                field: 'city',
                                width: 80,
                                title: '城市'
                            }, {
                                field: 'sign',
                                title: '签名',
                                width: '30%',
                                minWidth: 100
                            } //minWidth：局部定义当前单元格的最小宽度，layui 2.2.1 新增
                            , {
                                field: 'experience',
                                title: '积分'
                            }, {
                                field: 'score',
                                title: '评分'
                            }, {
                                field: 'classify',
                                title: '职业'
                            }, {
                                field: 'wealth',
                                width: 137,
                                title: '财富'
                            }, {
                                fixed: 'right',
                                title: '操作',
                                toolbar: '#table1Bar',
                                width: 250
                            }
                        ]
                    ],
                    done: function (res, curr, count) {
                        $('#content').scrollTop($('div[lay-id="table1"]').offset().top);
                    }
                });

            }
        })
        // 我的等级
        var jf = 50; //现有积分
        var dj = [0, 50, 80]; //积分等级
        var isUpgrade = false; //是否已升级
        var is = true;
        if (jf >= dj[dj.length - 1]) {
            //积分等于最大等级
            var _index = dj.length - 2;
            if (isUpgrade) {
                //如果已升级，同上
                $('.dj-b ul li.the').eq(dj.length - 1).addClass('on');
                $('.dj-b ul li.the').eq(dj.length - 1).find('p').eq(0).hide();
                $('.dj-b ul li.the').eq(dj.length - 1).find('p').eq(1).show();
                for (var i = 0; i < dj.length - 1; i++) {
                    $('.dj-b ul li.the').eq(i).addClass('success');
                    $('.dj-b ul li.line').eq(i).find('span').width('100%');
                    if (i != 0) {
                        $('.dj-b ul li.the').eq(i).find('p').eq(0).hide();
                        $('.dj-b ul li.the').eq(i).find('p').eq(1).show();
                    }
                }
                setTimeout(function () {
                    layer.tips('总共' + jf + '分', $(
                        '.dj-b ul li.the').eq(dj.length - 1), {
                        tips: [1, '#333333'],
                        skin: 'dj-tips',
                        tipsMore: true,
                        time: 0
                    });
                    $('.dj-tips').css({
                        'left': parseInt($('.dj-tips').css('left')) - 195,
                        'top': parseInt($('.dj-tips').css('top')) - 110
                    })
                    $('#content .container').append($('.dj-tips'))
                }, 100);
                $('.dj-t p').eq(dj.length - 1).show();
            } else {
                //如果没有升级，不显示当前等级动画，不显示当前等级徽章
                $('.dj-b ul li.the').eq(_index).addClass('on');
                //高亮当前等级徽章
                $('.dj-b ul li.the').eq(dj.length - 1).find('p').eq(0).hide();
                $('.dj-b ul li.the').eq(dj.length - 1).find('p').eq(1).show();
                for (var i = 0; i < dj.length - 1; i++) {
                    $('.dj-b ul li.the').eq(i).addClass('success');
                    $('.dj-b ul li.line').eq(i).find('span').width('100%');
                    if (i != 0) {
                        $('.dj-b ul li.the').eq(i).find('p').eq(0).hide();
                        $('.dj-b ul li.the').eq(i).find('p').eq(1).show();
                    }
                }
                setTimeout(function () {
                    layer.tips(
                        '<span style="color:#FADA8A;cursor:pointer;" onclick="goTops(' + (dj
                            .length - 1) + ')">立即岗位升级</span>',
                        $(
                            '.dj-b ul li.the').eq(dj.length - 1), {
                            tips: [1, '#333333'],
                            skin: 'dj-tips',
                            tipsMore: true,
                            time: 0
                        });
                    $('.dj-tips').css({
                        'left': parseInt($('.dj-tips').css('left')) - 210,
                        'top': parseInt($('.dj-tips').css('top')) - 110
                    })
                    $('#content .container').append($('.dj-tips'))
                }, 100)
                $('.dj-t p').eq(_index).show();
            }
        } else {
            //积分没有超过且等于最大等级
            dj.forEach(function (item, index) {
                if (!is) return;
                //判断当前积分是否小于当前等级积分线
                if (jf < item) {
                    is = false;
                    //如果小于当前等级积分线,则确认用户积分未到当前等级，且最大等级是上一级
                    var _index = index - 1;
                    if (isUpgrade) {
                        //上一等级添加动画效果
                        $('.dj-b ul li.the').eq(_index).addClass('on');
                        //上一级必须大于一级，之前的等级才填充颜色，并高亮图标
                        if (_index > 0) {
                            //上一等级图标高亮
                            $('.dj-b ul li.the').eq(_index).find('p').eq(0).hide();
                            $('.dj-b ul li.the').eq(_index).find('p').eq(1).show();
                            $('.dj-b ul li.line').eq(_index).find('span').width((((jf - dj[_index]) / (
                                item - dj[_index])) * 100) + '%');
                            for (var i = 0; i < _index; i++) {
                                $('.dj-b ul li.the').eq(i).addClass('success');
                                $('.dj-b ul li.line').eq(i).find('span').width('100%');
                                if (i != 0) {
                                    $('.dj-b ul li.the').eq(i).find('p').eq(0).hide();
                                    $('.dj-b ul li.the').eq(i).find('p').eq(1).show();
                                }
                            }
                        } else {
                            $('.dj-b ul li.line').eq(_index).find('span').width((((jf - dj[_index]) / (
                                item - dj[_index])) * 100) + '%');
                        }
                        //提示离这一个等级还需多少分
                        setTimeout(function () {
                            layer.tips('总共' + jf + '分 还需' + (dj[index] - jf) + '分', $(
                                '.dj-b ul li.line').eq(_index), {
                                tips: [1, '#333333'],
                                skin: 'dj-tips',
                                tipsMore: true,
                                time: 0
                            });
                            $('.dj-tips').css({
                                'left': parseInt($('.dj-tips').css('left')) - 220,
                                'top': parseInt($('.dj-tips').css('top')) - 110
                            })
                            $('#content .container').append($('.dj-tips'))
                        }, 100);
                        //显示上一级的徽章
                        $('.dj-t p').eq(_index).show();
                    } else {
                        //如果没有升级，不显示当前等级动画，不显示当前等级徽章
                        //高亮当前等级徽章
                        if (_index > 0) {
                            $('.dj-b ul li.the').eq(_index - 1).addClass('on');
                            $('.dj-b ul li.the').eq(_index).find('p').eq(0).hide();
                            $('.dj-b ul li.the').eq(_index).find('p').eq(1).show();
                            $('.dj-b ul li.line').eq(_index).find('span').width((((jf - dj[_index]) / (
                                item - dj[_index])) * 100) + '%');
                            for (var i = 0; i < _index; i++) {
                                $('.dj-b ul li.the').eq(i).addClass('success');
                                $('.dj-b ul li.line').eq(i).find('span').width('100%');
                                if (i != 0) {
                                    $('.dj-b ul li.the').eq(i).find('p').eq(0).hide();
                                    $('.dj-b ul li.the').eq(i).find('p').eq(1).show();
                                }
                            }
                            setTimeout(function () {
                                layer.tips(
                                    '<span style="color:#FADA8A;cursor:pointer;" onclick="goTops(' +
                                    (_index) + ')">立即岗位升级</span>',
                                    $(
                                        '.dj-b ul li.the').eq(_index), {
                                        tips: [1, '#333333'],
                                        skin: 'dj-tips',
                                        tipsMore: true,
                                        time: 0
                                    });
                                $('.dj-tips').css({
                                    'left': parseInt($('.dj-tips').css('left')) - 210,
                                    'top': parseInt($('.dj-tips').css('top')) - 110
                                })
                                $('#content .container').append($('.dj-tips'))
                            }, 100)
                            $('.dj-t p').eq(_index - 1).show();
                        } else {
                            $('.dj-b ul li.the').eq(_index).addClass('on');
                            $('.dj-b ul li.line').eq(_index).find('span').width((((jf - dj[_index]) / (
                                item - dj[_index])) * 100) + '%');
                            //提示离这一个等级还需多少分
                            setTimeout(function () {
                                layer.tips('总共' + jf + '分 还需' + (dj[index] - jf) + '分', $(
                                    '.dj-b ul li.line').eq(_index), {
                                    tips: [1, '#333333'],
                                    skin: 'dj-tips',
                                    tipsMore: true,
                                    time: 0
                                });
                                $('.dj-tips').css({
                                    'left': parseInt($('.dj-tips').css('left')) - 220,
                                    'top': parseInt($('.dj-tips').css('top')) - 110
                                })
                                $('#content .container').append($('.dj-tips'))
                            }, 100);
                            //显示上一级的徽章
                            $('.dj-t p').eq(_index).show();
                        }
                    }
                } else if (jf == item) {
                    is = false;
                    //如果当前积分等级当前等级积分线
                    //判断是否已升级
                    var _index = index;
                    if (isUpgrade) {
                        //如果已升级
                        if (_index > 0) {
                            $('.dj-b ul li.the').eq(_index).addClass('on');
                            $('.dj-b ul li.the').eq(_index).find('p').eq(0).hide();
                            $('.dj-b ul li.the').eq(_index).find('p').eq(1).show();
                            for (var i = 0; i < _index; i++) {
                                $('.dj-b ul li.the').eq(i).addClass('success');
                                if (i != 0) {
                                    $('.dj-b ul li.the').eq(i).find('p').eq(0).hide();
                                    $('.dj-b ul li.the').eq(i).find('p').eq(1).show();
                                }
                            }
                        } else {
                            $('.dj-b ul li.line').eq(_index).find('span').width((((jf - dj[_index]) / (
                                item - dj[_index])) * 100) + '%');
                            $('.dj-b ul li.the').eq(_index).addClass('on');
                        }
                        //提示离下一个等级还需多少分
                        setTimeout(function () {
                            layer.tips('总共' + jf + '分 还需' + (dj[_index + 1] - jf) + '分', $(
                                '.dj-b ul li.line').eq(_index), {
                                tips: [1, '#333333'],
                                skin: 'dj-tips',
                                tipsMore: true,
                                time: 0
                            });
                            $('.dj-tips').css({
                                'left': parseInt($('.dj-tips').css('left')) - 220,
                                'top': parseInt($('.dj-tips').css('top')) - 110
                            })
                            $('#content .container').append($('.dj-tips'))
                        }, 100);
                        $('.dj-t p').eq(_index).show();
                    } else {
                        //如果没有升级，不显示当前等级动画，不显示当前等级徽章
                        //高亮当前等级徽章
                        if (_index > 0) {
                            $('.dj-b ul li.the').eq(_index - 1).addClass('on');
                            $('.dj-b ul li.the').eq(_index).find('p').eq(0).hide();
                            $('.dj-b ul li.the').eq(_index).find('p').eq(1).show();
                            for (var i = 0; i < _index; i++) {
                                $('.dj-b ul li.the').eq(i).addClass('success');
                                if (i != 0) {
                                    $('.dj-b ul li.the').eq(i).find('p').eq(0).hide();
                                    $('.dj-b ul li.the').eq(i).find('p').eq(1).show();
                                }
                            }
                            setTimeout(function () {
                                layer.tips(
                                    '<span style="color:#FADA8A;cursor:pointer;" onclick="goTops(' +
                                    (_index) + ')">立即岗位升级</span>',
                                    $(
                                        '.dj-b ul li.the').eq(_index), {
                                        tips: [1, '#333333'],
                                        skin: 'dj-tips',
                                        tipsMore: true,
                                        time: 0
                                    });
                                $('.dj-tips').css({
                                    'left': parseInt($('.dj-tips').css('left')) - 210,
                                    'top': parseInt($('.dj-tips').css('top')) - 110
                                })
                                $('#content .container').append($('.dj-tips'))
                            }, 100)
                            $('.dj-t p').eq(_index - 1).show();
                        } else {
                            $('.dj-b ul li.the').eq(_index).addClass('on');
                            $('.dj-b ul li.line').eq(_index).find('span').width((((jf - dj[_index]) / (
                                item - dj[_index])) * 100) + '%');
                            //提示离下一个等级还需多少分
                            setTimeout(function () {
                                layer.tips('总共' + jf + '分 还需' + (dj[_index + 1] - jf) + '分', $(
                                    '.dj-b ul li.line').eq(_index), {
                                    tips: [1, '#333333'],
                                    skin: 'dj-tips',
                                    tipsMore: true,
                                    time: 0
                                });
                                $('.dj-tips').css({
                                    'left': parseInt($('.dj-tips').css('left')) - 220,
                                    'top': parseInt($('.dj-tips').css('top')) - 110
                                })
                                $('#content .container').append($('.dj-tips'))
                            }, 100);
                            $('.dj-t p').eq(_index).show();
                        }
                    }
                }
            });
        }
    })
</script>